"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Command-line to compile continuations.
 */
const babel = require("babel-core");
const cli = require("./parse-compiler-opts");
const fs = require("fs");
const callcc_1 = require("../callcc/callcc");
const flatness_1 = require("./flatness");
const util_1 = require("@stopify/util");
const hygiene = require("@stopify/hygiene");
require("source-map-support/register");
const visitor = {
    Program(path) {
        util_1.transformFromAst(path, [[hygiene.plugin, { reserved: [] }]]);
        util_1.transformFromAst(path, [flatness_1.flatness]);
        util_1.transformFromAst(path, [[callcc_1.default, cli.compilerOpts]]);
        path.stop();
    }
};
const opts = {
    plugins: [function () { return { visitor }; }],
    babelrc: false,
    code: true,
    ast: false,
};
const result = babel.transformFileSync(cli.srcPath, opts);
fs.writeFileSync(cli.dstPath, result.code);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9vbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21waWxlci90b29sLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7O0dBRUc7QUFDSCxvQ0FBb0M7QUFFcEMsNkNBQTZDO0FBQzdDLHlCQUF5QjtBQUV6Qiw2Q0FBc0M7QUFDdEMseUNBQXNDO0FBQ3RDLHdDQUFpRDtBQUNqRCw0Q0FBNkM7QUFDN0MsdUNBQXFDO0FBRXJDLE1BQU0sT0FBTyxHQUFZO0lBQ3ZCLE9BQU8sQ0FBQyxJQUF5QjtRQUMvQix1QkFBZ0IsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFFLE9BQU8sQ0FBQyxNQUFNLEVBQUUsRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLENBQUUsQ0FBQyxDQUFDLENBQUM7UUFDL0QsdUJBQWdCLENBQUMsSUFBSSxFQUFFLENBQUMsbUJBQVEsQ0FBQyxDQUFDLENBQUM7UUFDbkMsdUJBQWdCLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxnQkFBTSxFQUFFLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDckQsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2QsQ0FBQztDQUNGLENBQUM7QUFFRixNQUFNLElBQUksR0FBMkI7SUFDbkMsT0FBTyxFQUFFLENBQUMsY0FBYSxPQUFPLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDN0MsT0FBTyxFQUFFLEtBQUs7SUFDZCxJQUFJLEVBQUUsSUFBSTtJQUNWLEdBQUcsRUFBRSxLQUFLO0NBQ1gsQ0FBQztBQUdGLE1BQU0sTUFBTSxHQUFHLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQzFELEVBQUUsQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMifQ==